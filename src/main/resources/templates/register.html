<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>Join Us - HotelGroup</title>
</head>
<body>

<div layout:fragment="content" class="d-flex align-items-center justify-content-center min-vh-100 bg-light py-5">
    <div class="container" style="max-width: 600px;">

        <div class="text-center mb-5">
            <div class="logo-box mx-auto mb-4 bg-dark">
                <span class="text-white font-serif fw-bold fs-4">H</span>
            </div>
            <h2 class="font-serif fw-bold mb-2">Become a Member</h2>
            <p class="text-secondary small">Create an account to unlock exclusive benefits</p>
        </div>

        <div class="bg-white p-5 shadow-sm border-top border-4 border-dark rounded-1">

            <form id="registerForm">
                <div class="row g-3">

                    <div class="col-md-4">
                        <label class="form-label text-secondary text-uppercase fw-bold x-small" style="letter-spacing: 0.05em;">Last Name</label>
                        <input type="text" name="lastName" class="form-control rounded-1" required>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label text-secondary text-uppercase fw-bold x-small" style="letter-spacing: 0.05em;">First Name</label>
                        <input type="text" name="firstName" class="form-control rounded-1" required>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label text-secondary text-uppercase fw-bold x-small" style="letter-spacing: 0.05em;">Middle Name</label>
                        <input type="text" name="middleName" class="form-control rounded-1" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label x-small fw-bold text-uppercase">Desired DB Username</label>
                        <input type="text" name="dbUser" class="form-control" placeholder="my_login" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label x-small fw-bold text-uppercase">Desired DB Password</label>
                        <input type="password" name="dbPassword" class="form-control" placeholder="••••••••" required>
                    </div>

                    <div class="col-12">
                        <hr class="text-light my-2">
                    </div>

                    <div class="col-12">
                        <label class="form-label text-secondary text-uppercase fw-bold x-small" style="letter-spacing: 0.05em;">Phone Number</label>
                        <input type="text" name="phone" class="form-control rounded-1" placeholder="+380..." required>
                        <div class="form-text x-small text-muted">Використовуватиметься для входу в систему.</div>
                    </div>

                    <div class="col-12">
                        <label class="form-label text-secondary text-uppercase fw-bold x-small" style="letter-spacing: 0.05em;">Email Address</label>
                        <input type="email" name="email" class="form-control rounded-1" placeholder="you@example.com" required>
                    </div>
                </div>

                <div class="mt-5">
                    <button type="button" onclick="submitRegister()" class="btn btn-luxury w-100 py-2">
                        Create Account
                    </button>
                </div>
            </form>

            <div class="mt-4 text-center pt-4 border-top">
                <p class="small text-secondary mb-0">
                    Already have an account?
                    <a href="/login" class="text-dark fw-bold text-decoration-none border-bottom border-dark pb-0 hover-opacity">Sign In</a>
                </p>
            </div>
        </div>
    </div>
</div>

<script layout:fragment="script">
    async function submitRegister() {
        // 1. Знаходимо форму
        const form = document.getElementById('registerForm');
        const formData = new FormData(form);

        // 2. Блокуємо кнопку (візуальний ефект)
        const btn = document.querySelector('button[onclick="submitRegister()"]');
        const originalText = btn.innerText;
        btn.disabled = true;
        btn.innerText = "Processing...";

        console.log("Sending data..."); // Для налагодження (F12 -> Console)

        try {
            // 3. Відправляємо запит
            const response = await fetch('/api/public/register', {
                method: 'POST',
                body: formData
            });

            // 4. Читаємо відповідь
            const text = await response.text();
            console.log("Server response:", text);

            if (response.ok) {
                // Успіх - перенаправляємо
                alert('Registration successful! Please login.');
                window.location.href = '/login';
            } else {
                // Помилка з бекенду
                let message = text;
                try {
                    // Спробуємо дістати гарне повідомлення з JSON, якщо є
                    const json = JSON.parse(text);
                    if(json.message) message = json.message;
                } catch(e) {} // Якщо не JSON, лишаємо текст як є

                alert('Registration failed: ' + message);
            }
        } catch (error) {
            console.error('Network Error:', error);
            alert('System error. Check console for details.');
        } finally {
            // Повертаємо кнопку в робочий стан
            btn.disabled = false;
            btn.innerText = originalText;
        }
    }
</script>

<style>
    .x-small { font-size: 0.7rem; }
    .hover-opacity:hover { opacity: 0.7; }
</style>

</body>
</html>